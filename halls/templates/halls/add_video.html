{% extends 'halls/base.html' %}
{% load static %}
{% block content %}
<div class="container">
    <h1>Add Video to {{ hall.title }}</h1>
    <form method="post">
        {% csrf_token %}
        {% load widget_tweaks %}

        {% for field in form %}
        <div class="form-group {% if field.errors %}alert alert-danger{% endif %}">
            {{ field.errors }}
            {{ field.label_tag }}
            {% render_field field class="form-control" %}
        </div>
        {% endfor %}

        {% comment %} alternative way to  display the entire form with default style {% endcomment %}
        {% comment %} <table>
        {{ form.as_table}}
        </table> {% endcomment %}
        <button type="submit" class="btn btn-primary">Add</button>
    </form>

    <br>

    <h2>OR</h2>
    <form>
        {% for field in search_form %}
        <div class="form-group {% if field.errors %}alert alert-danger{% endif %}">
            {{ field.errors }}
            {{ field.label_tag }}
            {% render_field field class="form-control" %}
        </div>
        {% endfor %}
        {% comment %} {{search_form}} {% endcomment %}

    </form>

    {% comment %} for showing search result  {% endcomment %}
    <div id="search_results">
        <script>
            {% comment %} purpose : not to search immediately on every character while typing in the search box, cuz it will trigger API to call every time , then quota will be fulled {% endcomment %}
            var delayTimer; 
            $('#id_search_term').keyup(function(){
                clearTimeout(delayTimer);
                $('#search_results').text('loading....');  
                
                <!-- set timer -->
                delayTimer = setTimeout(function(){

                    <!--get the value from search box-->
                    var text = $('#id_search_term').val(); 

                    <!--make ajax call (inside below curly braces {}are the dictionary that gonna pass data with ajax to server )--> 
                    $.ajax({
                        url: '/video/search',<!-- url from server side -->
                        data:{
                            'search_term': text <!-- pass this data from Browser front end to server -->
                        },
                        dataType:'json', <!-- datatype id Json -->
                        success: function(data){ <!-- after successful got response from server -->

                            var results = '';
                            $('#search_results').text('');

                            data['items'].forEach(function(video){
                                results += video['snippet']['title']
                            });
                            $('#search_results').append(results);
                        }

                    });

                },1000);
            });

        </script>

    </div>
</div>
{% endblock %}